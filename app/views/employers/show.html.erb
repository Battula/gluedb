<%- model_class = Employer -%>
<%t '.title', :default => model_class.model_name.human.titleize.pluralize %>
<div class="page-header">
  <ul class="breadcrumb">
    <li><%= link_to model_class.model_name.human.titleize.pluralize, employers_path %></li>
    <li class="active"><%= @employer.name %></li>
  </ul>
</div>

<div class="row">
  <div class="col-md-2">
    <div class="well sidebar-nav">
      <%= controls_for_employers(@employer) %>
    </div>
  </div>

  <div class="col-md-10">
    <div class="row">
      <div class="col-md-12">
        <h4><%= @employer.name %></h4>
        <dl class="dl-horizontal">
          <dt>HBX ID</dt>
          <dd><%= @employer.hbx_id %></dd>
          <dt><%= model_class.human_attribute_name(:fein) %></dt>
          <dd><%= number_to_fein(@employer.fein) %></dd>
          <dt><%= model_class.human_attribute_name(:aasm_state) %></dt>
          <dd><%= @employer.aasm_state.humanize %></dd>
          <dt><%= model_class.human_attribute_name(:sic_code) %></dt>
          <dd><%= @employer.sic_code %></dd>
          <dt><%= model_class.human_attribute_name(:open_enrollment_start) %></dt>
          <dd><%= @employer.open_enrollment_start %></dd>
          <dt><%= model_class.human_attribute_name(:open_enrollment_end) %></dt>
          <dd><%= @employer.open_enrollment_end %></dd>
          <dt><%= model_class.human_attribute_name(:plan_year_start) %></dt>
          <dd><%= @employer.plan_year_start %></dd>
          <dt><%= model_class.human_attribute_name(:plan_year_end) %></dt>
          <dd><%= @employer.plan_year_end %></dd>
          <dt><%= model_class.human_attribute_name(:fte_count) %></dt>
          <dd><%= @employer.fte_count %></dd>
          <dt><%= model_class.human_attribute_name(:pte_count) %></dt>
          <dd><%= @employer.pte_count %></dd>
          <dt><%= model_class.human_attribute_name(:msp_count) %></dt>
          <dd><%= @employer.msp_count %></dd>


          <dt><%= "Carrier(s)" %></dt>
          <% if @employer.carriers.count == 0 %>
            <dd></dd>
          <% end %>
          <% @employer.carriers.each do |c| %>
            <dd><%= link_to c.name, carrier_path(c) %></dd>
          <% end %>
          

          <dt><%= "Plan(s)" %></dt>
          <% if @employer.plans.count == 0 %>
            <dd></dd>
          <% end %>
          <% @employer.plans.each do |p| %>
            <dd><%= link_to p.name, carrier_path(p.carrier) %></dd>
          <% end %>

          <dt>Broker</dt>
          <% if @employer.broker.nil? %>
            <dd></dd>
          <% else %>
            <dd><%= link_to(@employer.broker.name_full, @employer.broker) %></dd>
          <% end %>
          
        </dl>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <h4>Employees</h4>
        <%= render "people/people_list", people: @employer.employees %>

        <h4>Elected Plans</h4>
        <%= render "elected_plans_table", elected_plans: @employer.elected_plans %>

        <h4>Payments</h4>
        <%= render 'payments_table', premium_payments: @employer.premium_payments %>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <h4>Contact</h4>
        <% @employer.emails.each do |email| %> 
          <dl class="dl-horizontal">
            <dt><%= "#{mixed_case(email.email_type)} 
             #{model_class.human_attribute_name(:email)}" %></dt>
            <dd><%= email.email_address %></dd>
          </dl>
        <% end %>

        <% @employer.phones.each do |phone| %>
          <dl class="dl-horizontal">
            <dt><%= "#{mixed_case(phone.phone_type)}
              #{model_class.human_attribute_name(:phone)}" %></dt>
            <dd><% if @employer.phones.first.extension.present? %>
              <%= number_to_phone(phone.phone_number, area_code: true, extension: phone.extension) %>
              <% else %>
              <%= number_to_phone(phone.phone_number, area_code: true) %>
              <% end %>
            </dd>
          </dl>
        <% end %>

        <% @employer.addresses.each do |address| %> 
          <dl class="dl-horizontal">
            <dt><%= "#{mixed_case(address.address_type)} 
             #{model_class.human_attribute_name(:address)}" %></dt>
            <dd><%= address.formatted_address %></dd>
          </dl>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="col-md-12">
  <p class="text-right"><small><%= "version: #{@employer.version} | updated: #{@employer.updated_at.strftime('%m-%d-%Y') if @employer.updated_at.present?}" %></small></p>

  <div class="well well-sm default">
    <div class="form-actions">
     <%= link_to t('.back', :default => t("helpers.links.back")), employers_path, :class => 'btn btn-primary'  %>
    </div>
  </div>
</div>
